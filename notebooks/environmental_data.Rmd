---
title: "Gatherig environmental and location data"
author: "Harly Durbin"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyr)
library(stringr)
library(dplyr)
library(glue)
library(readxl)
library(ggplot2)
library(magrittr)
library(purrr)
library(tidylog)

```

# Notes & questions

# Setup

```{r, warning=FALSE, message=FALSE}
cleaned <- read_rds(here::here("data/derived_data/import_join_clean/cleaned.rds"))
```

```{r}
weather <- 
  read_rds(here::here("data/derived_data/environmental_data/weather.rds")) %>%  
  # Pull daily data from the `data` column and save it to its own column 
  mutate(daily = purrr::map(data, "daily", .default = NA),
         # Extract daily high from daily column
         daily_high = purrr::map_dbl(daily,
                              ~ .x %>% 
                                dplyr::pull(temperatureHigh))) %>% 
  # Remove the data column
  select(-data) 


```

# Data summary

## Days from May 1

```{r}
cleaned %>% 
  filter(!is.na(date_score_recorded)) %>% 
  mutate(from_may1 = as.numeric(date_score_recorded - lubridate::ymd(glue("{year}/05/01")))) %>% 
  summarise(mean = mean(from_may1),
            median = median(from_may1))
```

```{r}
cleaned %>% 
  filter(!is.na(date_score_recorded)) %>% 
  mutate(from_may1 = as.numeric(date_score_recorded - lubridate::ymd(glue("{year}/05/01")))) %>% 
  ggplot(aes(x = from_may1)) +
  geom_density()
```

## Daily high temperature

```{r}
weather %>% 
  group_by(date_score_recorded, lat, long) %>% 
  summarise(mean_high = mean(daily_high)) %>% 
  ungroup() %>% 
  ggplot(aes(x = mean_high)) +
  geom_density()
```

